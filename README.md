## data-cache

> 数据缓存解决方案，主要解决以下问题
> 1. 缓存穿透问题（布隆过滤器）
> 2. 缓存击穿问题
     > 延迟双删（该demo中采用的是延迟三删除，操作数据库前删除一次，操作缓存前删除一次，操作缓存后延迟一秒再删除一次。）
     > 延迟删除采用的是RabbitMQ延迟消息机制

在扩展时只需要增加对应的数据缓存工具类即可，注入缓存工具类统一采用反射的方式找到对应的工具类。大大降低了开发的复杂度。
下面是缓存的执行流程

### 初始化数据

```
+-----------------------+
|      开始初始化        |
+----------+------------+
           |
           v
+-----------------------+
| 记录日志："初始化员工信息..." |
+----------+------------+
           |
           v
+-----------------------+
| 数据库全量查询          |
| baseMapper.selectList |
+----------+------------+
           |
           v
+-----------------------+
| 遍历数据集             |
| userInfoVoList.forEach |
+----------+------------+
           |
           v
+-----------------------+
| 逐个保存到Redis        |
| cacheUtil.saveToRedis |
+----------+------------+
           |
           v
+-----------------------+
| 记录完成日志           |
| "共处理X条记录"        |
+----------+------------+
           |
           v
+-----------------------+
|        结束           |
+-----------------------+

```

### 分页查询

```
+---------------------+
|       开始          |
+----------+----------+
           |
           v
+---------------------+
| 从Redis获取所有用户数据 |
+----------+----------+
           |
           v
+---------------------+
|   按username排序     |
+----------+----------+
           |
           v
+---------------------+
|   缓存是否为空?      |
+---+------------+----+
    |            |
    v            v
+-------+    +---------------+
| 是    |    | 计算分页索引    |
|       |    +---------------+
|       |            |
|       |            v
|       |    +---------------+
|       |    | 处理分页溢出检查 |
|       |    +---------------+
|       |            |
|       |            v
|       |    +---------------+
|       |    | 从缓存截取分页数据 |
|       |    +---------------+
|       |            |
|       |            v
|       |    +---------------+
|       |    | 设置分页对象属性 |
|       |    +---------------+
|       |            |
|       v            v
|    +---------------+
|    | 从数据库查询分页 |
|    +---------------+
|            |
+----+-------+
     |
     v
+---------------------+
|     返回分页结果      |
+---------------------+
```

### 根据id查询

```
+---------------------+
|       开始          |
+----------+----------+
           |
           v
+---------------------+
|  从Redis获取数据     |
|  cacheUtil.getFromRedis |
+----------+----------+
           |
    +------+------+
    |             |
缓存命中         缓存未命中
    |             |
    v             v
+-------+    +---------------+
| 返回数据 |    | 从数据库查询    |
|       |    | baseMapper.selectById |
+-------+    +---------------+
                   |
                   v
             +---------------+
             | 数据存入Redis  |
             | cacheUtil.saveToRedis |
             +---------------+
                   |
                   v
             +---------------+
             |    返回数据    |
             +---------------+
```

### 新增流程

```
+---------------------+
|       开始          |
+----------+----------+
           |
           v
+---------------------+
| 删除Redis缓存        |
| cacheUtil.deleteFromRedis |
+----------+----------+
           |
           v
+---------------------+
| 保存数据到数据库      |
| this.save(dto)      |
+----------+----------+
           |
    +------+------+
    |             |
保存成功         保存失败
    |             |
    v             v
+-------+    +---------------+
| 查询数据库 |    | 返回false     |
| selectById |    |             |
+-------+    +---------------+
    |             |
    v             |
+---------------+ |
| 更新数据到Redis | |
| saveToRedis   | |
+---------------+ |
    |             |
    v             |
+---------------+ |
|   返回true     | |
+---------------+ |
    |             |
    +------+------+
           |
           v
+---------------------+
|       结束          |
+---------------------+

```

### 修改流程

```
+---------------------+
|       开始          |
+----------+----------+
           |
           v
+---------------------+
| 删除Redis缓存        |
| deleteFromRedis     |
+----------+----------+
           |
           v
+---------------------+
| 更新数据库记录        |
| updateById          |
+----------+----------+
           |
    +------+------+
    |             |
更新成功         更新失败
    |             |
    v             v
+-------+    +---------------+
| 查询完整数据 |    | 返回false     |
| getById   |    |             |
+-------+    +---------------+
    |             |
    v             |
+---------------+ |
| 保存新数据到Redis | |
| saveToRedis   | |
+---------------+ |
    |             |
    v             |
+---------------+ |
|   返回true     | |
+---------------+ |
    |             |
    +------+------+
           |
           v
+---------------------+
|       结束          |
+---------------------+

```

### 删除流程

```
+---------------------+
|       开始          |
+----------+----------+
           |
           v
+---------------------+
| 批量删除数据库记录     |
| deleteBatchIds      |
+----------+----------+
           |
    +------+------+
    |             |
删除成功         删除失败
    |             |
    v             v
+-------+    +---------------+
|检查ID列表|    | 返回false     |
|是否非空 |    |             |
+-------+    +---------------+
    |             |
    v             |
+---------------+ |
| 循环删除Redis缓存| |
| deleteFromRedis| |
+---------------+ |
    |             |
    v             |
+---------------+ |
|   返回true     | |
+---------------+ |
    |             |
    +------+------+
           |
           v
+---------------------+
|       结束          |
+---------------------+

```